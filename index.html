<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>AgentK by kyriosli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">AgentK</h1>
      <h2 class="project-tagline">Node.JS web开发框架</h2>
      <a href="https://github.com/kyriosli/agentk" class="btn">View on GitHub</a>
      <a href="https://github.com/kyriosli/agentk/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/kyriosli/agentk/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="agentk-全新的nodejs开发框架" class="anchor" href="#agentk-%E5%85%A8%E6%96%B0%E7%9A%84nodejs%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6" aria-hidden="true"><span class="octicon octicon-link"></span></a>AgentK: 全新的<code>Node.JS</code>开发框架</h1>

<h2>
<a id="简介" class="anchor" href="#%E7%AE%80%E4%BB%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>简介</h2>

<p>AgentK 是一个集开发流程和运维于一体的<code>Node.JS</code>开发框架，旨在解决快速搭建<code>Node.JS</code>项目过程中常见的难题。如果我们从头搭建一个项目，或者从未接触过<code>Node.JS</code>开发，往往需要考虑：</p>

<ul>
<li>如何组织代码</li>
<li>如何规范代码格式，选择可靠的模块化和异步回调解决方案</li>
<li>如何实现可伸缩与服务可靠性</li>
</ul>

<p>等等诸如此类问题。单纯一个集群配置和宕机重启可能都要花费很多精力；而回调地狱更是让新手老手都头痛不已，但<code>Promise</code>等其它的编程范式又存在学习成本。</p>

<p>AgentK从四个角度解决上述问题：</p>

<ol>
<li>支持全新的ES6风格的模块书写和加载方式，使得代码书写更加规范</li>
<li>通过协程方案解决了回调问题，异步代码可以同步书写，函数的封装对调用者不透明，不需要学习新的编程范式</li>
<li>集成进程管理和集群功能，提供操作系统级别的进程守护，防止意外宕机或被误杀</li>
<li>集成路由/模版引擎等常见功能，规范化开发细节</li>
</ol>

<h2>
<a id="快速上手" class="anchor" href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>快速上手</h2>

<h3>
<a id="安装篇" class="anchor" href="#%E5%AE%89%E8%A3%85%E7%AF%87" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装篇</h3>

<p>AgentK可以通过<code>npm</code>进行安装。打开一个终端，输入:</p>

<pre><code>npm install kyriosli/agentk -g
</code></pre>

<p>当然如果您正在使用 linux/osx，可能会遇到没有权限的问题，请自行加sudo解决。</p>

<p>AgentK还支持<code>bash</code>/<code>zsh</code>的自动补全，所以如果您正在使用 linux/osx，或者 windows下的 mingw32等环境，可以配置一下自动补全，输入：</p>

<pre><code>ak completion &gt;&gt; ~/.bashrc (或者 ~/.zshrc如果您正在使用zsh)
</code></pre>

<p>如果要自动补全生效，还需要重新打开终端或重新登录</p>

<h3>
<a id="代码编写篇" class="anchor" href="#%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E7%AF%87" aria-hidden="true"><span class="octicon octicon-link"></span></a>代码编写篇</h3>

<p>AgentK使用<code>ES6</code>(即<code>ECMAScript 2015</code>, 最新的JavaScript规范)包含的<a href="https://github.com/lukehoban/es6features#modules">module</a>和<a href="https://github.com/lukehoban/es6features#promises">Promise</a>来组织代码和异步接口调用。关于<code>module</code>和<code>Promise</code>的相关教程可以参考
<a href="#TODO">TODO</a> 和 <a href="#TODO">TODO</a></p>

<p>同时，它使用了 <a href="https://github.com/laverdet/node-fibers">Fibers</a> 来规避 Node.JS的回调问题。下面的一段代码展示了一个简单的http服务器，它提供了两个接口：一个静态文件接口和一个反向代理。(完整代码参考 <a href="https://github.com/kyriosli/agentk/blob/master/test/test.js">test.js</a>)</p>

<div class="highlight highlight-js"><pre><span class="pl-c">// test.js</span>
<span class="pl-k">import</span> {listen, request, read} <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../src/module/http.js<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> * <span class="pl-k">as</span> response <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../src/module/http_response.js<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> Router <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../src/module/router.js<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> * <span class="pl-k">as</span> view <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../src/module/view.js<span class="pl-pds">'</span></span>;

<span class="pl-k">const</span> <span class="pl-c1">route</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Router</span>();

route.<span class="pl-c1">prefix</span>(<span class="pl-s"><span class="pl-pds">'</span>/static<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">req</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(req.timeStart, req.url);
    <span class="pl-k">return</span> response.<span class="pl-c1">file</span>(req.url.<span class="pl-c1">substr</span>(<span class="pl-c1">1</span>))
        .setHeader(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>text/javascript<span class="pl-pds">'</span></span>)
        .enableGzip();
});

route.<span class="pl-c1">match</span>(<span class="pl-sr"><span class="pl-pds">/</span><span class="pl-k">^</span><span class="pl-cce">\/</span>(<span class="pl-c1">[<span class="pl-k">^</span><span class="pl-cce">\/</span>]</span><span class="pl-k">+</span>)(<span class="pl-cce">\/</span><span class="pl-c1">.</span><span class="pl-k">*</span>)<span class="pl-pds">/</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">host</span>, <span class="pl-smi">path</span>) {
    <span class="pl-en">console</span><span class="pl-c1">.log</span>(host, path);
    <span class="pl-k">var</span> tres <span class="pl-k">=</span> request({
        method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>,
        host<span class="pl-k">:</span> host,
        path<span class="pl-k">:</span> path
    });
    <span class="pl-k">return</span> response.stream(tres)
        .setStatus(tres.statusCode)
        .setHeaders(tres.<span class="pl-c1">headers</span>)
});

<span class="pl-k">let</span> server <span class="pl-k">=</span> listen(<span class="pl-c1">3000</span>, route);
<span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>test listening on<span class="pl-pds">'</span></span>, server.address());</pre></div>

<p>将以上代码保存为<code>test.js</code>，并在当前目录运行<code>ak run test.js</code>即可运行该程序。</p>

<h3>
<a id="running-the-program" class="anchor" href="#running-the-program" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the program</h3>

<p>Agentk can run the program directly, as well as guard its process to prevent system down, and restarts it when the server
maching is rebooted. Type <code>ak help</code> to get help message.</p>

<p>Available commands are:</p>

<ul>
<li>
<code>help</code>        print this help message</li>
<li>
<code>run</code>         run program without crash respawn</li>
<li>
<code>start</code>       start program</li>
<li>
<code>stop</code>        stop program</li>
<li>
<code>restart</code>     restart program</li>
<li>
<code>reload</code>      reload program (partial implemented)</li>
<li>
<code>status</code>      show program status</li>
<li>
<code>doc</code>         generate documentation (not implemented)</li>
<li>
<code>init</code>        initialize project structure (not implemented)</li>
<li>
<code>publish</code>     publish a module</li>
<li>
<code>logs</code>        print program stdout/stderr log message</li>
<li>
<code>svc-install</code> create init.rc script (not implemented)</li>
<li>
<code>svc-purge</code>   remove init.rc script (not implemented)</li>
<li>
<code>svc-start</code>   start service daemon</li>
<li>
<code>svc-stop</code>    stop service daemon</li>
<li>
<code>completion</code>  auto completion helper</li>
</ul>

<p>When using <code>ak start program</code> to enable guarding of the process, a <code>manifest.json</code> must be created in the program directory (see <a href="test/manifest.json">test/manifest.json</a>),
and the name of the program directory is supplied to the command line.</p>

<p><code>manifest.json</code> contains:</p>

<ul>
<li>
<code>main</code> the entry module path of the program. Default to "index.js"</li>
<li>
<code>directory</code> the work directory of the program. Default to the program directory</li>
<li>
<code>workers</code> number of processes to be spawned to run the program, default <code>1</code>
</li>
<li>
<code>stdout</code> the path of the stdout log file to be appended, default to <code>~/.agentk/out.log</code>
</li>
<li>
<code>stderr</code> the path of the stderr log file to be appended, default to <code>~/.agentk/err.log</code>
</li>
<li>
<code>dependencies</code> map the depended modules of the program to is revision.</li>
</ul>

<p>All paths are relative to the program directory.</p>

<p>Use <code>ak init</code> to create an empty program structure. (NOT implemented)</p>

<h2>
<a id="writing-modules" class="anchor" href="#writing-modules" aria-hidden="true"><span class="octicon octicon-link"></span></a>Writing modules</h2>

<p>TODO</p>

<h3>
<a id="module-server" class="anchor" href="#module-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Module server</h3>

<p>TODO</p>

<h3>
<a id="publishing-modules" class="anchor" href="#publishing-modules" aria-hidden="true"><span class="octicon octicon-link"></span></a>Publishing modules</h3>

<p>TODO</p>

<h3>
<a id="module-auto-loading" class="anchor" href="#module-auto-loading" aria-hidden="true"><span class="octicon octicon-link"></span></a>Module auto loading</h3>

<p>TODO</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/kyriosli/agentk">AgentK</a> is maintained by <a href="https://github.com/kyriosli">kyriosli</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

